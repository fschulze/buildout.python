define cfg
[buildout]
extends =
    src/base.cfg
    src/readline.cfg
    src/zlib.cfg
    src/$(buildout_target).cfg
python-buildout-root = $${buildout:directory}/src
parts =
    $${buildout:base-parts}
    $${buildout:readline-parts}
    $${buildout:zlib-parts}
    $${buildout:$(buildout_target)-parts}
endef
export cfg

all: .installed.cfg

test.cfg:
	test -e $@ || echo "$$cfg" > $@

get-pip.py:
    python -c "import urllib2; open('get-pip.py', 'wb').write(urllib2.urlopen('https://bootstrap.pypa.io/get-pip.py').read())"

bin/pip: get-pip.py
    python get-pip.py --isolated --prefix .

bin/buildout: bin/pip
	bin/pip install zc.buildout==1.4.4

.installed.cfg: test.cfg bin/buildout
	bin/buildout -vc test.cfg
